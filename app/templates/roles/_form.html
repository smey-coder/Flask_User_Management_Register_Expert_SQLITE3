<form method="post">
   {{ form.hidden_tag() }}

   <div class="mb-3">
      {{ form.name.label(class="form-label")}}
      {{ form.name(class="form-control")}}
      {% if form.name.error %}
      <div class="text-danger small">
         {% for error in form.name.errors %}
            <div>{{ error }}</div>
         {% endfor %}
      </div>
      {% endif %}
   </div>

   <div class="mb-3">
      {{ form.description.label(class="form-label")}}
      {{ form.description(class="form-control")}}
      {% if form.description.errors %}
         {% for error in form.description.errors %}
            <div class="text-danger small">{{ error }}</div>
         {% endfor %}
   </div>
   {% endif %}

   <div class="mb-3">
      <label class="form-label">{{ form.permission_ids.label.text }}</label>

      {% if form.permissions_by_module %}
         <div class="form-check">
            {% for module_name, perms in form.permissions_by_module.items() %}
               <div class="border rounded p-2 md-2">
               <div class="fw-bold small text-mutted mb-1">
                     {{ module_name}}
               </div>
               {% for perm in perms%}
               <div class="form-check">
                     <input
                        class="form-check-input"
                        type="checkbox"
                        id="perm_{{ perm.id}}"
                        name ="{{ form.permission_ids.name }}"
                        value="{{ perm.id }}"
                        {% if form.permission_ids.data and perm.id in form.permission_ids.data%} checked {% endif %}
                     >
                     <label class="form-check-label" for="perm_{{ perm.id}}">
                        <strong>{{ perm.code }}</strong> - {{ perm.name }}
                     </label>
               </div>
               {% endfor %}
               </div>
            {% endfor %}
         {% else %}
         <p class="text-muted small">No permissions defined yet.</p>
         {% endif %}
         {% for error in form.permission_ids.errors%}
         <div class="text-danger small">{{ error}}</div>
         {% endfor%}
      </div>

      <div class="d-flex justify-content-between mt-3">
         {{ form.submit(class="btn btn-primary")}}
         <a href="{{ url_for('tbl_roles.index')}}" class="btn btn-secondary">Cancel</a>
      </div>
   </div>
</form>